
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>How to Test 1: Find Errors to Make the Application Works - Contrast Of Beauty</title>
  <meta name="author" content="black@t">

  
  <meta name="description" content="This is an experiment tutorial to better learn some 101 practices and how testing can be a better replacement of developing by debugging. The goal of &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blackat.github.io/blog/2015/03/07/how-to-test-1-find-errors-to-make-the-application-works/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Contrast Of Beauty" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,700italic,400,700,600' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Sorts+Mill+Goudy:400,400italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Roboto:400,700,700italic,500,500italic' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-59763266-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Contrast Of Beauty</a></h1>
  
    <h2>I am just curious</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blackat.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/oo-design-principles">Design Principles</a></li>
  <li><a href="/design-patterns">Design Patterns</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">How to Test 1: Find Errors to Make the Application Works</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-07T09:37:33+01:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:37 am</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://blackat.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>This is an <em>experiment tutorial</em> to better learn some <em>101</em> practices and how testing can be a better replacement of developing by debugging.</p>

<p>The goal of the <em>experiment-project</em> is to find, to correct bugs and make the application works by writing tests.</p>

<div id="toc-table-content"><table cellpadding="0" cellspacing="0" id="toc-container"><tbody><td><section class="toc-panel"><div class="toc-heading"><h3 class="toc-title"><span class="glyphicon glyphicon-list-alt"></span> Contents</h3></div><ul id="toc-listing"><li class="toc-item"><a href="#TOC-1-a-bit-of-theory-and-jargon"><span class="tocnumber">1</span> <span class="toctext">A bit of theory and jargon</span></a></li><li class="toc-item"><a href="#TOC-2-clone-the-project"><span class="tocnumber">2</span> <span class="toctext">Clone the project</span></a><ul class="toc-list-item"><li class="toc-item"><a href="#TOC-2-1-project-structure"><span class="tocnumber">2.1</span> <span class="toctext">Project Structure</span></a></li></ul></li><li class="toc-item"><a href="#TOC-3-application-description"><span class="tocnumber">3</span> <span class="toctext">Application Description</span></a><ul class="toc-list-item"><li class="toc-item"><a href="#TOC-3-1-the-workflow"><span class="tocnumber">3.1</span> <span class="toctext">The workflow</span></a><ul class="toc-list-item"><li class="toc-item"><a href="#TOC-3-1-1-the-workflow-in-details"><span class="tocnumber">3.1.1</span> <span class="toctext">The workflow in details</span></a></li></ul></li><li class="toc-item"><a href="#TOC-3-2-how-to-initiliaze-the-service-and-run-it"><span class="tocnumber">3.2</span> <span class="toctext">How to initiliaze the service and run it</span></a></li></ul></li><li class="toc-item"><a href="#TOC-4-lets-correct-the-application"><span class="tocnumber">4</span> <span class="toctext">Let’s correct the application</span></a><ul class="toc-list-item"><li class="toc-item"><a href="#TOC-4-1-tweetcollector-class"><span class="tocnumber">4.1</span> <span class="toctext">TweetCollector Class</span></a></li><li class="toc-item"><a href="#TOC-4-2-tweetercollectortest"><span class="tocnumber">4.2</span> <span class="toctext">TweeterCollectorTest</span></a><ul class="toc-list-item"><li class="toc-item"><a href="#TOC-4-2-1-method-accept-3-errors"><span class="tocnumber">4.2.1</span> <span class="toctext">Method accept() - 3 errors</span></a></li><li class="toc-item"><a href="#TOC-4-2-2-method-flush-1-error"><span class="tocnumber">4.2.2</span> <span class="toctext">Method flush() - 1 error</span></a></li></ul></li><li class="toc-item"><a href="#TOC-4-3-cloudservice-class"><span class="tocnumber">4.3</span> <span class="toctext">CloudService Class</span></a><ul class="toc-list-item"><li class="toc-item"><a href="#TOC-4-3-1-cloudservicetest-class"><span class="tocnumber">4.3.1</span> <span class="toctext">CloudServiceTest Class</span></a></li><li class="toc-item"><a href="#TOC-4-3-2-method-addcollector-2-errors"><span class="tocnumber">4.3.2</span> <span class="toctext">Method addCollector() - 2 errors</span></a></li><li class="toc-item"><a href="#TOC-4-3-3-method-openconnection-1-error"><span class="tocnumber">4.3.3</span> <span class="toctext">Method openConnection() - 1 error</span></a></li><li class="toc-item"><a href="#TOC-4-3-4-method-saveobject-0-errors"><span class="tocnumber">4.3.4</span> <span class="toctext">Method saveObject() - 0 errors</span></a></li><li class="toc-item"><a href="#TOC-4-3-5-additional-class-behavior-tests"><span class="tocnumber">4.3.5</span> <span class="toctext">Additional class behavior tests</span></a></li></ul></li></ul></li></ul></section></td></tbody></table></div>


<h2 id="TOC-1-a-bit-of-theory-and-jargon">A bit of theory and jargon</h2>

<p><em>SUT:</em> the System Under Test, in a unit test it could be a <em>class</em>.</p>

<p><em>Test class:</em> the <em>client</em> of the interface exposed by the SUT.</p>

<p><em>test fixture:</em> the context under which a test is run, it is a baseline under which running tests. It is a set of operations to bring the <em>System Under Test (SUT)</em> in a given state, run the test and verify the <em>expected outcome</em>. Test fixture and the expected outcome are tightly coupled, the test fixture allows the test to be repeatable for ever and ever. Method <code>setUp()</code> or <code>initialization</code> is used to create fixture while <code>tearDown()</code> or <code>distruction</code> is invoked to restore the original state.</p>

<p>A test has four phases:</p>

<ol>
<li><strong>set up</strong> to <em>apply</em> the test fixture;</li>
<li><strong>exercise</strong> to <em>interact</em> with the API exposed by the SUT;</li>
<li><strong>verifiy</strong> to check if the expected outcome has been <em>matched</em>;</li>
<li><strong>tear down</strong> to return to the <em>original state</em> tearing down the test fixture.</li>
</ol>


<h2 id="TOC-2-clone-the-project">Clone the project</h2>

<p>Clone the project from <a href="https://github.com/blackat/tutorial-howtotest-1-collectors">Github</a> and import it in you preferred IDE, <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a> in my case.</p>

<h3 id="TOC-2-1-project-structure">Project Structure</h3>

<pre><code>├── README.md
├── exercise-api
│   ├── pom.xml
│   └── src
│       └── main
│           └── java
│               └── com
│                   └── contrastofbeauty
│                       └── tutorial
│                           └── api
│                               ├── collectors
│                               │   └── Collector.java
│                               ├── domain
│                               │   ├── AcknoledgeService.java
│                               │   └── Callback.java
│                               └── services
│                                   └── Service.java
├── exercise-to-be-corrected
│   ├── pom.xml
│   └── src
│       ...
│
├── exercise-working
│   ├── pom.xml
│   └── src
│       ...
│
└── pom.xml
</code></pre>

<p>The maven project is composed by four modules:</p>

<ol>
<li><strong>exercise-api:</strong> just collection of interfaces used in the other two modules;</li>
<li><strong>exercise-working:</strong> working application with a test suite;</li>
<li><strong>exercise-to-be-corrected:</strong> application with bugs where the test suite has to be created in order to find, correct bugs and make it work;</li>
<li><strong>exercise-tdd:</strong> implementation of some classes by tdd whose description is in the next <a href="/blog/2015/03/21/how-to-test-2-tdd-a-simple-example">tut</a>.</li>
</ol>


<p>In the module <code>exercise-to-be-corrected</code> run the class <code>RunMeToBeCorrected.java</code> and see that it fails some some reason, may be a <code>NullPointerException</code> is thrown. We do not care so much because we do not want to make it work by a common pattern <strong>running/debugging</strong> rather we want to <em>implement missing tests</em> demonstrating how they can help us to find and correct bug make our application more robust.</p>

<h2 id="TOC-3-application-description">Application Description</h2>

<p>The application is mainly composed by a fake <a href="https://github.com/blackat/tutorial-howtotest-1-collectors/blob/master/exercise-working/src/main/java/com/contrastofbeauty/tutorial/services/CloudService.java">Cloud Service</a> able to post user’s tweets in batch by means of a <a href="https://github.com/blackat/tutorial-howtotest-1-collectors/blob/master/exercise-working/src/main/java/com/contrastofbeauty/tutorial/collectors/TweetCollector.java">Tweet Collector</a>. <a href="http://yuml.me/edit/3555184c">Here</a> the UML source.</p>

<p><img class="center" src="/images/posts/tutorial_1_how_to_test.png"></p>

<h3 id="TOC-3-1-the-workflow">The workflow</h3>

<ol>
<li>The <code>CloudService</code> <em>has a</em> certain numbers of different type collectors (hence the association in the UML diagram), in this case just with one able to collect tweets.</li>
<li>A user who wants to post tweet in batch has to open a connection invoking the method <code>service.openConnection()</code> of the service.</li>
<li>The user then starts to post tweets using the method <code>service.saveObject()</code>.</li>
<li>Once done <code>service.saveObjectCompleted()</code> method will be called to tell the service that the user session is finished.</li>
</ol>


<h4 id="TOC-3-1-1-the-workflow-in-details">The workflow in details</h4>

<ol>
<li>The <code>CloudService</code> <em>has a</em> <code>TweetCollector</code> and a <code>Callback</code> implementation instance (Another approach is to leave the service the initialization of the callback function and substitute the <em>association</em> with a <em>composition</em> in the UML diagram).</li>
<li>The <code>Callback</code> implementation instance will be set into each added collector by the service.</li>
<li>Every time a user wants to save a tweet through the service, the collector will stock it in a <em>list</em> as a sort of buffer.</li>
<li>Once the collector has stocked a certain amount of tweets, for instance 500, it will generates a <em>task</em>.</li>
<li>A task has a collection of tweets and the implementation of the method <code>call()</code> which will be called by one of the thread of the thread pool. The method specifies how the list of tweets should be treated, for instance: saved, destroyed, sent to Twitter, printed or something else.</li>
<li>A collector uses the <code>Callback</code> instance to add a task to a <em>processing list</em>.</li>
<li>The list of active tasks will be then processed by a thread pool.</li>
</ol>


<h3 id="TOC-3-2-how-to-initiliaze-the-service-and-run-it">How to initiliaze the service and run it</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>RunMeWorking.java</span> — <a href="https://github.com/blackat/tutorial-howtotest-1-collectors/blob/master/exercise-working/src/main/java/com/contrastofbeauty/tutorial/RunMeWorking.java">Link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RunMeWorking</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">        <span class="n">Callback</span> <span class="n">callback</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">CallbackImpl</span><span class="o">();</span>
</span><span class="line">        <span class="n">Service</span> <span class="n">service</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">CloudService</span><span class="o">(</span><span class="n">callback</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">        <span class="n">service</span><span class="o">.</span><span class="na">addCollector</span><span class="o">(</span><span class="k">new</span> <span class="nf">TweetCollector</span><span class="o">());</span>
</span><span class="line">
</span><span class="line">        <span class="n">service</span><span class="o">.</span><span class="na">openConnection</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
</span><span class="line">        <span class="n">service</span><span class="o">.</span><span class="na">saveObject</span><span class="o">(</span><span class="k">new</span> <span class="nf">Tweet</span><span class="o">(</span><span class="s">"I am Felix the awesome cat."</span><span class="o">),</span> <span class="mi">1L</span><span class="o">);</span>
</span><span class="line">        <span class="n">service</span><span class="o">.</span><span class="na">saveObjectCompleted</span><span class="o">(</span><span class="k">new</span> <span class="nf">AcknoledgeServiceImpl</span><span class="o">(),</span> <span class="mi">1L</span><span class="o">);</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p><strong>Actually</strong> the service does not post anything to Twitter, it is just a way to show a bit of java concurrency and how to write <em>unit tests</em> when dealing with concurrent structures like <code>Future</code>.</p>

<h2 id="TOC-4-lets-correct-the-application">Let’s correct the application</h2>

<p>Let’s create tests for the application starting from <code>TweetCollector.java</code> class, press <code>cmd + shift + T</code> on Mac or <code>crtl + shift + T</code> on Windows and choose methods you want to test, then Idea will create the test class in the right place</p>

<pre><code>src/test/java/com/contrastofbeauty/tutorial/collectors/TweetCollectorTest.java.
</code></pre>

<p><strong>Tip</strong> Make sure the path <code>src/test/java</code> exists, otherwise Idea will create the test class together with the source one.</p>

<p><img class="center" src="/images/posts/idea-test-wizard.png"></p>

<h3 id="TOC-4-1-tweetcollector-class">TweetCollector Class</h3>

<p><img class="center" src="/images/posts/tweet-collector.png"></p>

<p><a href="https://github.com/blackat/tutorial-howtotest-1-collectors/blob/master/exercise-to-be-corrected/src/main/java/com/contrastofbeauty/tutorial/collectors/TweetCollector.java">TweetCollector</a> is specific implementation of <code>Collector</code> interface able to stores an object of a specific type in a <code>List</code> by <code>userId</code> when its method <code>accept()</code> is invoked (e.g. by the service cloud).</p>

<p>Once the tweet collector has collected a certain number of tweet objects, <code>flush()</code> method is called, a <code>TweetTask</code> object is created and passed an parameter to <code>callbackFunction.addTask()</code>. The task in then put in a queue to be processed. A task is a computation unit, it owns:</p>

<ul>
<li><code>call()</code> method: called by a thread when the task is available in the task queue;</li>
<li>processing list: a set of object on which the aforementioned method will work.</li>
</ul>


<p>Once the task is added to the queue the list is emptied, ready to accept new object to be processed.</p>

<h3 id="TOC-4-2-tweetercollectortest">TweeterCollectorTest</h3>

<p>Populate the <code>setUp()</code> method creating a new <code>TweetCollector</code> and annotate it with <code>@Before</code> in order to get it run automatically before any method annotated with <code>@Test</code> as specfied by <a href="http://junit.sourceforge.net/javadoc/org/junit/Before.html">JUnit doc</a>. Evrytime a test method is run, the <code>setUp()</code> method is invoked to have a fresh and clean collector object.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TweetCollectorTest</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="kd">private</span> <span class="n">Collector</span> <span class="n">collector</span><span class="o">;</span>
</span><span class="line">
</span><span class="line">    <span class="nd">@Before</span>
</span><span class="line">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">        <span class="n">collector</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">TweetCollector</span><span class="o">();</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h4 id="TOC-4-2-1-method-accept-3-errors">Method accept() - 3 errors</h4>

<p>Let’s start working on the method <code>accept(Object object, long userId)</code>. Create, or rename the method if already created by the IDE, <code>testAcceptGoldenPath()</code> and add the following assertion:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAcceptGoldenPath</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">    <span class="n">assertTrue</span><span class="o">(</span><span class="n">collector</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="k">new</span> <span class="nf">Tweet</span><span class="o">(</span><span class="s">"foo tweet"</span><span class="o">),</span> <span class="mi">1L</span><span class="o">));</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>In the first test we want to test the <em>standard scenario</em> when everything run smooth, no exceptional situations. So for this reason it has been added the suffix <em>GoldenPath</em>, an alternative to <a href="http://en.wikipedia.org/wiki/Happy_path">Happy Path</a>. After that some borderline scenario tests will be added. <em>So run the test!</em></p>

<h5>Error 1</h5>

<p><strong>Issue:</strong> a <code>NullPointerException</code> is thrown.</p>

<p><strong>Solution:</strong> the object <code>processingList</code> has not been initialized. Add the initialization in the constructor for instance and <em>rerun the test</em>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">public</span> <span class="nf">TweetCollector</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">processingList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h5>Error 2</h5>

<p><strong>Issue:</strong> another <code>NullPointerException</code> is thrown because the data structure is accessed but not initialized for a given user:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">processingList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">userId</span><span class="o">).</span><span class="na">add</span><span class="o">((</span><span class="n">Tweet</span><span class="o">)</span> <span class="n">object</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p><strong>Solution:</strong> check if a given <code>userId</code> already exists in the map, if not create and add to the map the pair and <em>rerun the test</em>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="k">if</span> <span class="o">(</span><span class="n">processingList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">userId</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="n">processingList</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">userId</span><span class="o">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Tweet</span><span class="o">&gt;());</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h5>Error 3</h5>

<p><strong>Issue:</strong> an <code>AssertionError</code> is thrown. All the <code>NPE</code> have been fixed but it seems the collector has not accepted the <code>Tweet</code> object.</p>

<p><strong>Solution:</strong> a missing <code>return true</code> prevent the method to behave correctly. Add the aforementioned statement and <em>rerun the test</em>. Now the test passes and this is the complete code for the method <code>accept</code>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">accept</span><span class="o">(</span><span class="n">Object</span> <span class="n">object</span><span class="o">,</span> <span class="kt">long</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="k">if</span> <span class="o">(</span><span class="n">object</span> <span class="k">instanceof</span> <span class="n">Tweet</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">processingList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">userId</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">processingList</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">userId</span><span class="o">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Tweet</span><span class="o">&gt;());</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="n">processingList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">userId</span><span class="o">).</span><span class="na">add</span><span class="o">((</span><span class="n">Tweet</span><span class="o">)</span> <span class="n">object</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">customBufferSize</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="k">if</span> <span class="o">(</span><span class="n">processingList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">userId</span><span class="o">).</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="n">customBufferSize</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                <span class="n">flush</span><span class="o">(</span><span class="n">userId</span><span class="o">);</span>
</span><span class="line">            <span class="o">}</span>
</span><span class="line">        <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">processingList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">userId</span><span class="o">).</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="n">PROCESSING_LIST_BUFFER_SIZE</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">flush</span><span class="o">(</span><span class="n">userId</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h5>Additional tests</h5>

<p>The method now seems correct but has been tested in case of a different obejcts? Add a new test method which will be part of the <em>automatic test suite</em> we are going to create. This automatic test suite will help us during phases such as refactoring, improving code readability and method evolution.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAcceptObjectNotAcceptedBecauseDifferentType</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">    <span class="n">assertFalse</span><span class="o">(</span><span class="n">collector</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="k">new</span> <span class="nf">Object</span><span class="o">(),</span> <span class="mi">1L</span><span class="o">));</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Our automatic net of tests starts to take shape.</p>

<h4 id="TOC-4-2-2-method-flush-1-error">Method flush() - 1 error</h4>

<p>The method <code>flush()</code> does not have a return type, so how can we test the <em>correct behavior</em>?</p>

<p><strong>Idea:</strong> indeed, we want to test the correct behavior! we need to find a way to check if the behavior of the method is the expected one so if it follows the right path. When <code>flush()</code> is invoke we expect the creation of a <code>TweetTask</code> object and the invocation of <code>addTask()</code> method.</p>

<p>Let’s try step by step. If not done yet by the IDE, create method <code>testFlushGoldenPath()</code> and invoke the method <code>flush()</code>, then <em>run the test!</em></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFlushGoldenPath</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">    <span class="n">collector</span><span class="o">.</span><span class="na">flush</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h5>Error 1</h5>

<p><strong>Issue:</strong> a <code>NullPointerException</code> is thrown. This is not a good behavior, the map has not been initialized if the method will be directly called.</p>

<p><strong>Pre-solution:</strong> check if in the map exist a <code>List</code> for the given <code>userId</code>, if not simply exit from the method execution (other solutions are acceptable, depends on requirements), <em>rerun the method</em>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="k">if</span> <span class="o">(</span><span class="n">processingList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">userId</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="k">return</span><span class="o">;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>The test passes, but <strong>no verification</strong> is done, so the test is pretty <em>useless</em>. We want to verify that if there is an item, a new <code>TweetTask</code> is created and the method <code>callbackFunction.addTask()</code> is invoked.</p>

<p><strong>Idea:</strong> the <code>callbackFunction</code> has not been set yet so a possible <code>NPE</code> could arise. May be in the future it will be inject by <em>DI</em>. So we can use <a href="https://code.google.com/p/mockito/">Mockito</a> to create a mock object and verify if the method <code>addTask()</code> has been called.</p>

<p><strong>Solution:</strong> mock a <code>Callback.class</code> class in order to make a verification on an <em>expected behavior</em> and change a bit the <code>setUp()</code> method to initialize mocks via annotations. Moreover set the callback and add at least one tweet object just to reproduce a small common scenario.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Mock</span>
</span><span class="line"><span class="kd">private</span> <span class="n">Callback</span> <span class="n">callbackFunctionMock</span><span class="o">;</span>
</span><span class="line">
</span><span class="line"><span class="nd">@Before</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">    <span class="n">MockitoAnnotations</span><span class="o">.</span><span class="na">initMocks</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class="line">    <span class="n">collector</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">TweetCollector</span><span class="o">();</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFlushGoldenPath</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="n">collector</span><span class="o">.</span><span class="na">setCallbackFunction</span><span class="o">(</span><span class="n">callbackFunctionMock</span><span class="o">);</span>
</span><span class="line">    <span class="n">collector</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="k">new</span> <span class="nf">Tweet</span><span class="o">(</span><span class="s">"foo tweet"</span><span class="o">),</span> <span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">    <span class="n">collector</span><span class="o">.</span><span class="na">flush</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">verify</span><span class="o">(</span><span class="n">callbackFunctionMock</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">addTask</span><span class="o">(</span><span class="n">any</span><span class="o">(</span><span class="n">TweetTask</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">anyInt</span><span class="o">());</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>So we set the callback function, we invoke the <code>accept()</code> method to put one tweet into the list for a given user and finally we call the <code>flush()</code> method. A mock object is useful to verify behaviors for instance if a given method has been called. In our case we want to verify if the method <code>addTask()</code> has been called <em>exactly one time</em>. <code>any(java.lang.Class)</code> and <code>anyInt()</code> belongs to <code>org.mockito.Matchers</code> library. A <em>matcher</em> is an entity that helps to match <em>parameters</em> and <em>arguments</em>. For instance, in the test, we need to mach method call <em>parameters</em>, <code>addTask(java.util.concurrent.Callable task, long userId)</code>, but we are not interested to pass specific <em>arguments</em> so we use <em>matchers</em> to say whatever object implementing <code>Callable</code> class is fine.</p>

<p><strong>Why?</strong> Well, we are not directly call the <code>addTask</code>, we just call a method from a public interface that, under certain condition, should call <code>addTask</code> with a newly created object. We do not control and we do not want to control the creation of the object, just let it be, but we want to verify if the method has been invoked with some instances of a given class. In Mockito if we use a matcher for an argument, all the other arguments must be substituted with matchers.</p>

<p><strong>Best practice</strong> Name a mock variable with <code>mock</code> prefix in order to recognize at first sight which variable is a reference to a real object or to a mock. Other patterns are possible, chose the one you like and keep the whole project consistent.</p>

<p><strong>Attention</strong> A test class is not just a test on methods but it is a <em>test to verify the correct behavior of the all unit</em>.</p>

<h5>Alternative solution with Mockito.spy()</h5>

<p>A <em>mock object</em> has been used, but another kind of test double exists, the <em>spy</em>. A <code>spy</code> is a <em>stub</em> (state verification) able to record <em>calling information</em>, it is a <em>“partial mock”</em>. Instead of doing the check on <code>processingList.get(userId)</code> at the beginning of the class it is possible to refactor the tweet creation in a separate method as</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">flush</span><span class="o">(</span><span class="kt">long</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="c1">// create a new processing task</span>
</span><span class="line">    <span class="k">if</span> <span class="o">(</span><span class="n">callbackFunction</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="n">TweetTask</span> <span class="n">tweetTask</span> <span class="o">=</span> <span class="n">getTweetTask</span><span class="o">(</span><span class="n">userId</span><span class="o">);</span>
</span><span class="line">        <span class="k">if</span><span class="o">(</span><span class="n">tweetTask</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">callbackFunction</span><span class="o">.</span><span class="na">addTask</span><span class="o">(</span><span class="n">tweetTask</span><span class="o">,</span> <span class="n">userId</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class="line">        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Callback function must be set by the service."</span><span class="o">);</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">protected</span> <span class="n">TweetTask</span> <span class="nf">getTweetTask</span><span class="o">(</span><span class="kt">long</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="n">TweetTask</span> <span class="n">tweetTask</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">TweetTask</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">processingList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">userId</span><span class="o">)));</span>
</span><span class="line">    <span class="n">processingList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">userId</span><span class="o">).</span><span class="na">clear</span><span class="o">();</span>
</span><span class="line">    <span class="k">return</span> <span class="n">tweetTask</span><span class="o">;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>and the corresponding modified test using <code>Mokito.spy()</code> to avoid the invoke on method <code>accept()</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFlushWithSpyGoldenPath</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="n">TweetCollector</span> <span class="n">spyOnTweetCollector</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">spy</span><span class="o">(</span><span class="n">TweetCollector</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">spyOnTweetCollector</span><span class="o">.</span><span class="na">setCallbackFunction</span><span class="o">(</span><span class="n">callbackFunctionMock</span><span class="o">);</span>
</span><span class="line">    <span class="n">doReturn</span><span class="o">(</span><span class="k">new</span> <span class="nf">TweetTask</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Tweet</span><span class="o">&gt;())).</span><span class="na">when</span><span class="o">(</span><span class="n">spyOnTweetCollector</span><span class="o">).</span><span class="na">getTweetTask</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">spyOnTweetCollector</span><span class="o">.</span><span class="na">flush</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">verify</span><span class="o">(</span><span class="n">callbackFunctionMock</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">addTask</span><span class="o">(</span><span class="n">any</span><span class="o">(</span><span class="n">TweetTask</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">anyInt</span><span class="o">());</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p><strong>Best practice</strong> Name a spy variable with <code>spyOn</code> prefix in order to recognize at first sight which variable is a reference to a real object, to a spy or to a mock.</p>

<p><strong>Attention</strong> We do not have invoked <code>accept()</code> method</p>

<h5>Another alternative solution without Mockito but with @Override</h5>

<p>Just to make a simple comparison, the above test could have been written without <em>Mockito</em> as follows:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFlushWithOverrideGoldenPath</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="kd">final</span> <span class="n">AtomicBoolean</span> <span class="n">taskAdded</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AtomicBoolean</span><span class="o">();</span>
</span><span class="line">
</span><span class="line">    <span class="n">Callback</span> <span class="n">callbackFunction</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">CallbackImpl</span><span class="o">(){</span>
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addTask</span><span class="o">(</span><span class="n">TweetTask</span> <span class="n">tweetTask</span><span class="o">,</span> <span class="kt">long</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">taskAdded</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">};</span>
</span><span class="line">
</span><span class="line">    <span class="n">TweetCollector</span> <span class="n">collector</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">TweetCollector</span><span class="o">(){</span>
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">protected</span> <span class="n">TweetTask</span> <span class="nf">getTweetTask</span><span class="o">(</span><span class="kt">long</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="k">new</span> <span class="nf">TweetTask</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Tweet</span><span class="o">&gt;());</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">};</span>
</span><span class="line">
</span><span class="line">    <span class="n">collector</span><span class="o">.</span><span class="na">setCallbackFunction</span><span class="o">(</span><span class="n">callbackFunction</span><span class="o">);</span>
</span><span class="line">    <span class="n">collector</span><span class="o">.</span><span class="na">flush</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">assertTrue</span><span class="o">(</span><span class="n">taskAdded</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>The use of <em>Mockito</em> makes the code more concise, easy to read, maintain and understand. Moreover the <em>behavior verification</em> is easy to understand than using a variable and check its value. By using ‘verify()’ we directly verify if the method has been called and how many times, it is <strong>clear</strong> that we are doing <em>behavior verification</em>.</p>

<h5>Additional tests</h5>

<p>Another test can be written to <a href="http://junit.org/apidocs/org/junit/rules/ExpectedException.html">test the exception</a> along with the message in case the <code>callbackFunction</code> is not set.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFlushExceptionThrownWithNullCallbackFunction</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">    <span class="n">exception</span><span class="o">.</span><span class="na">expect</span><span class="o">(</span><span class="n">IllegalArgumentException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class="line">    <span class="n">exception</span><span class="o">.</span><span class="na">expectMessage</span><span class="o">(</span><span class="s">"Callback function is null, it must be set by the service."</span><span class="o">);</span>
</span><span class="line">    <span class="n">collector</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="k">new</span> <span class="nf">Tweet</span><span class="o">(</span><span class="s">"foo tweet"</span><span class="o">),</span> <span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">    <span class="n">collector</span><span class="o">.</span><span class="na">flush</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Exception messages are really important in order to immediately find the root cause of the issue.</p>

<hr>

<h3 id="TOC-4-3-cloudservice-class">CloudService Class</h3>

<p><img class="center" src="/images/posts/cloud-service.png"></p>

<p>Once the service is created, once or more collectors are added in order to provide batch processing to one or more social networks or other services. A user has to open a connection to the service through the method <code>openConnection()</code> and then start to post tweets invoking <code>saveObject()</code>. Once done the user calls method <code>saveObjectCompleted()</code> to post latest tweets and close the connection.</p>

<h4 id="TOC-4-3-1-cloudservicetest-class">CloudServiceTest Class</h4>

<p>Create the class as done for the previous example and initialize the <em>System Under Test (SUT)</em>. The test class is the API client exposed by the SUT. The <code>setUp()</code> method properly initializes the SUT in order to be ready for the test method.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CloudServiceTest</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="kd">private</span> <span class="n">CloudService</span> <span class="n">cloudService</span><span class="o">;</span>
</span><span class="line">
</span><span class="line">    <span class="kd">private</span> <span class="n">Callback</span> <span class="n">callbackFunction</span><span class="o">;</span>
</span><span class="line">
</span><span class="line">    <span class="nd">@Before</span>
</span><span class="line">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">        <span class="n">callbackFunction</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">CallbackImpl</span><span class="o">();</span>
</span><span class="line">        <span class="n">cloudService</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">CloudService</span><span class="o">(</span><span class="n">callbackFunction</span><span class="o">);</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h4 id="TOC-4-3-2-method-addcollector-2-errors">Method addCollector() - 2 errors</h4>

<p>Create the first test for method <code>addCollector()</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAddCollectorGoldenPath</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">addCollector</span><span class="o">(</span><span class="k">new</span> <span class="nf">TweetCollector</span><span class="o">());</span>
</span><span class="line">
</span><span class="line">    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">cloudService</span><span class="o">.</span><span class="na">getCollectorSize</span><span class="o">());</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h5>Error 1</h5>

<p><strong>Issue:</strong> a <code>NullPointerException</code> will be thrown when <code>CloudService.getCollectorSize()</code> is called in the assertion.</p>

<p><strong>Solution:</strong> the object <code>processingCollectors</code> has not been initialized. Add the initialization in the constructor, for instance, and <em>rerun the test</em>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">public</span> <span class="nf">CloudService</span><span class="o">(</span><span class="n">Callback</span> <span class="n">callback</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="n">processingCollectors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h5>Error 2 - Test Driven Development (TDD)</h5>

<p>Spot this error is not easy, it is a missing code. As it has been seen before, a collector uses a callback function to post a batch processing. When a collector is added the callback function must be set by the service. The collector in this situation acts as a <em>collaborator</em> and we want to verify that a specific method is invoke on the collaborator itself. Create the <em>test before</em> and <em>implementation later on</em> to make the test passes (TDD).</p>

<p>In order to verify a method call, i.e. <em>indirect output</em>, we use Mockito, so add <code>tweetCollectorMock</code> variable and init mocks inside of the <code>setUp()</code> (initialization of the test fixture) method adding <code>MockitoAnnotations.initMocks(this)</code> and <em>run the test</em></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Mock</span>
</span><span class="line"><span class="kd">private</span> <span class="n">TweetCollector</span> <span class="n">tweetCollectorMock</span><span class="o">;</span>
</span><span class="line">
</span><span class="line"><span class="nd">@Before</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="n">MockitoAnnotations</span><span class="o">.</span><span class="na">initMocks</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class="line">    <span class="n">callbackFunction</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">CallbackImpl</span><span class="o">();</span>
</span><span class="line">    <span class="n">cloudService</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">CloudService</span><span class="o">(</span><span class="n">callbackFunction</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAddCollectorVerifyCallbackFunctionAddedWithMockito</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">addCollector</span><span class="o">(</span><span class="n">tweetCollectorMock</span><span class="o">);</span>
</span><span class="line">    <span class="n">verify</span><span class="o">(</span><span class="n">tweetCollectorMock</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">setCallbackFunction</span><span class="o">(</span><span class="n">any</span><span class="o">(</span><span class="n">Callback</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p><strong>Issue:</strong> an error is thrown <code>Wanted but not invoked:...</code> that means the method <code>setCallbackFunction()</code> has not been called.</p>

<p><strong>Solution:</strong> in the method <code>addCollector()</code> add the call to set the callback function and  <em>rerun the test</em>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">addCollector</span><span class="o">(</span><span class="n">Collector</span> <span class="n">collector</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">RuntimeException</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="n">processingCollectors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">collector</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">collector</span><span class="o">.</span><span class="na">setCallbackFunction</span><span class="o">(</span><span class="n">callbackFunction</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Now the test passes. The <code>addCollector()</code> function has been corrected by tests. The tests have been left separated for two reasons:</p>

<ol>
<li>test two different aspects of the same function</li>
<li>how <em>Test Driven Development (TDD)</em> helps building a solid net of automated tests and a more reliable code, tests come directly from requirements.</li>
</ol>


<p><strong>Attention!</strong> TDD helps creating a tests net, tests represent the requirements, the documentation as code that can be read to understand the behavior of the class. The code satisfying the tests is consistent with the requirements, its behavior is something to <em>rely on</em> for the next development iteration.</p>

<h5>Error 2 - Alternative solution with @Override</h5>

<p>Instead of using a mocking framework, it is possible to <em>“intercept”</em> the call of the method and register a status that can be used for verification later on as following:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAddCollectorVerifyCallbackFunctionAddedWithOverride</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="kd">final</span> <span class="n">AtomicInteger</span> <span class="n">functionCalled</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AtomicInteger</span><span class="o">();</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">addCollector</span><span class="o">(</span><span class="k">new</span> <span class="nf">TweetCollector</span><span class="o">(){</span>
</span><span class="line">
</span><span class="line">    <span class="nd">@Override</span>
</span><span class="line">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCallbackFunction</span><span class="o">(</span><span class="n">Callback</span> <span class="n">callback</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">            <span class="n">functionCalled</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">});</span>
</span><span class="line">
</span><span class="line">    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">functionCalled</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>The use of a mock object and a mocking framework as Mockito allows to have a more concise and readable code. Methods and matchers such as  <code>verify</code>, <code>times()</code> and <code>any()</code> make the comprehension of the test easier. Moreover using a mock for a collector makes clearer that in this context it a <em>collaborator</em> and not the object of the test, it is even closer to a documentation purpose.</p>

<h4 id="TOC-4-3-3-method-openconnection-1-error">Method openConnection() - 1 error</h4>

<p>Let’s create a new test and run it</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testOpenConnectionGoldenPath</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">openConnection</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">    <span class="n">assertTrue</span><span class="o">(</span><span class="n">cloudService</span><span class="o">.</span><span class="na">isUserConnected</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">));</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h5>Error 1</h5>

<p><strong>Issue:</strong> a <code>NullPointerException</code> will be thrown.</p>

<p><strong>Solution:</strong> the object <code>processingFutureList</code> has not been initialized. Add the initialization in the constructor for instance and <em>rerun the test</em>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">public</span> <span class="nf">CloudService</span><span class="o">(</span><span class="n">Callback</span> <span class="n">callback</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="n">processingFutureList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span><span class="line">
</span><span class="line">    <span class="n">processingCollectors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Now the test passes.</p>

<h5>Additional test</h5>

<p>To build a <em>net of automatic tests</em> is interesting to test different aspects of a method so we can add the following one</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testOpenConnectionUserHasNotOpenConnection</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">assertFalse</span><span class="o">(</span><span class="n">cloudService</span><span class="o">.</span><span class="na">isUserConnected</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">));</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h4 id="TOC-4-3-4-method-saveobject-0-errors">Method saveObject() - 0 errors</h4>

<p>This method does not have errors anymore, but one or more test must be written to build up an efficient <em>test suite</em>. It is a small workflow able to test the interface exposed by the class.</p>

<p><strong>Remember!</strong> Test the behavior of <em>all the unit</em> not just single and separated methods, the focus is on the all unit.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSaveObjectWithOverrideGoldenPath</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="kd">final</span> <span class="n">AtomicBoolean</span> <span class="n">accepted</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AtomicBoolean</span><span class="o">();</span>
</span><span class="line">
</span><span class="line">    <span class="n">Collector</span> <span class="n">tweetCollector</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">TweetCollector</span><span class="o">(){</span>
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">accept</span><span class="o">(</span><span class="n">Object</span> <span class="n">object</span><span class="o">,</span> <span class="kt">long</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">            <span class="k">if</span> <span class="o">(</span><span class="n">object</span> <span class="k">instanceof</span> <span class="n">Tweet</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                <span class="n">accepted</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class="line">                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class="line">            <span class="o">}</span>
</span><span class="line">
</span><span class="line">            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">};</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">addCollector</span><span class="o">(</span><span class="n">tweetCollector</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">openConnection</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">saveObject</span><span class="o">(</span><span class="k">new</span> <span class="nf">Tweet</span><span class="o">(</span><span class="s">"foo tweet"</span><span class="o">),</span> <span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">assertTrue</span><span class="o">(</span><span class="n">accepted</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Once again pay attention on the difference between using <em>override</em> and <em>Mockito</em> to test <em>indirect output</em> as follows</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSaveObjectWithMockitoGoldenPath</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="n">Collector</span> <span class="n">collectorMock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="n">TweetCollector</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class="line">    <span class="n">when</span><span class="o">(</span><span class="n">collectorMock</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">any</span><span class="o">(</span><span class="n">Tweet</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">anyInt</span><span class="o">())).</span><span class="na">thenReturn</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">addCollector</span><span class="o">(</span><span class="n">collectorMock</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">openConnection</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">saveObject</span><span class="o">(</span><span class="n">tweetMock</span><span class="o">,</span> <span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">verify</span><span class="o">(</span><span class="n">collectorMock</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">accept</span><span class="o">(</span><span class="n">any</span><span class="o">(</span><span class="n">Tweet</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">anyInt</span><span class="o">());</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Once again the use of Mockito allows to have a more concise and readable test. The <code>Mockito.verify()</code> method highlights the test of the <em>indirect output</em>.</p>

<h4 id="TOC-4-3-5-additional-class-behavior-tests">Additional class behavior tests</h4>

<h5>Additional test 1</h5>

<p>It is interesting to enrich the test suite with some other tests, may be a bit redundant but useful to highlight if the code correctly answer to borderline scenarios.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Rule</span>
</span><span class="line"><span class="kd">public</span> <span class="n">ExpectedException</span> <span class="n">exception</span> <span class="o">=</span> <span class="n">ExpectedException</span><span class="o">.</span><span class="na">none</span><span class="o">();</span>
</span><span class="line">
</span><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSaveObjectObjectNotAcceptedThrowException</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="n">exception</span><span class="o">.</span><span class="na">expect</span><span class="o">(</span><span class="n">IllegalArgumentException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class="line">    <span class="n">exception</span><span class="o">.</span><span class="na">expectMessage</span><span class="o">(</span><span class="s">"Entity of type "</span> <span class="o">+</span> <span class="k">new</span> <span class="nf">Object</span><span class="o">().</span><span class="na">getClass</span><span class="o">()</span> <span class="o">+</span> <span class="s">" cannot be accepted."</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">addCollector</span><span class="o">(</span><span class="k">new</span> <span class="nf">TweetCollector</span><span class="o">());</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">openConnection</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">saveObject</span><span class="o">(</span><span class="k">new</span> <span class="nf">Object</span><span class="o">(),</span> <span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h5>Additional test 2</h5>

<p>The name of the method makes the test self-explanatory.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSaveObjectUserNotConnected</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">    <span class="n">exception</span><span class="o">.</span><span class="na">expect</span><span class="o">(</span><span class="n">IllegalArgumentException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class="line">    <span class="n">exception</span><span class="o">.</span><span class="na">expectMessage</span><span class="o">(</span><span class="s">"User with id "</span> <span class="o">+</span> <span class="n">USER_ID</span> <span class="o">+</span> <span class="s">" has not open any connection, please open a connection "</span> <span class="o">+</span>
</span><span class="line">        <span class="s">"before trying to save."</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">saveObject</span><span class="o">(</span><span class="n">mock</span><span class="o">(</span><span class="n">Callable</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h5>Additional test 3</h5>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSaveObjectCompletedUserNotConnectedThrowException</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">    <span class="n">exception</span><span class="o">.</span><span class="na">expect</span><span class="o">(</span><span class="n">IllegalArgumentException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class="line">    <span class="n">exception</span><span class="o">.</span><span class="na">expectMessage</span><span class="o">(</span><span class="s">"User with id "</span> <span class="o">+</span> <span class="n">USER_ID</span> <span class="o">+</span> <span class="s">" has not open any connection, please open a connection "</span> <span class="o">+</span>
</span><span class="line">        <span class="s">"before trying to save."</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">saveObjectCompleted</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h5>Additional test 4</h5>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSaveObjectCompletedGoldenPath</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="n">doNothing</span><span class="o">().</span><span class="na">when</span><span class="o">(</span><span class="n">acknoledgeServiceMock</span><span class="o">).</span><span class="na">sendAckSuccess</span><span class="o">();</span>
</span><span class="line">
</span><span class="line">    <span class="n">TweetCollector</span> <span class="n">spyOntweetCollector</span> <span class="o">=</span> <span class="n">spy</span><span class="o">(</span><span class="k">new</span> <span class="nf">TweetCollector</span><span class="o">());</span>
</span><span class="line">    <span class="c1">// if you call the real method there will be an exception, use doReturn for stubbing</span>
</span><span class="line">    <span class="n">doReturn</span><span class="o">(</span><span class="n">tweetTaskMock</span><span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">spyOntweetCollector</span><span class="o">).</span><span class="na">getTweetTask</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">    <span class="n">when</span><span class="o">(</span><span class="n">tweetTaskMock</span><span class="o">.</span><span class="na">call</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">addCollector</span><span class="o">(</span><span class="n">spyOntweetCollector</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">openConnection</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">saveObject</span><span class="o">(</span><span class="k">new</span> <span class="nf">Tweet</span><span class="o">(</span><span class="s">"foo tweet"</span><span class="o">),</span> <span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">saveObjectCompleted</span><span class="o">(</span><span class="n">acknoledgeServiceMock</span><span class="o">,</span> <span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">verify</span><span class="o">(</span><span class="n">tweetTaskMock</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">call</span><span class="o">();</span>
</span><span class="line">    <span class="n">verify</span><span class="o">(</span><span class="n">acknoledgeServiceMock</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">sendAckSuccess</span><span class="o">();</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h5>Additional test 5</h5>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Test</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSaveObjectCompletedExceptionThrown</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class="line">    <span class="n">doNothing</span><span class="o">().</span><span class="na">when</span><span class="o">(</span><span class="n">acknoledgeServiceMock</span><span class="o">).</span><span class="na">sendAckSuccess</span><span class="o">();</span>
</span><span class="line">
</span><span class="line">    <span class="n">TweetCollector</span> <span class="n">spyOntweetCollector</span> <span class="o">=</span> <span class="n">spy</span><span class="o">(</span><span class="k">new</span> <span class="nf">TweetCollector</span><span class="o">());</span>
</span><span class="line">    <span class="c1">// if you call the real method there will be an exception, use doReturn for stubbing</span>
</span><span class="line">    <span class="n">doReturn</span><span class="o">(</span><span class="n">tweetTaskMock</span><span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">spyOntweetCollector</span><span class="o">).</span><span class="na">getTweetTask</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">    <span class="n">when</span><span class="o">(</span><span class="n">tweetTaskMock</span><span class="o">.</span><span class="na">call</span><span class="o">()).</span><span class="na">thenThrow</span><span class="o">(</span><span class="n">InterruptedException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">addCollector</span><span class="o">(</span><span class="n">spyOntweetCollector</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">openConnection</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">saveObject</span><span class="o">(</span><span class="k">new</span> <span class="nf">Tweet</span><span class="o">(</span><span class="s">"foo tweet"</span><span class="o">),</span> <span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">cloudService</span><span class="o">.</span><span class="na">saveObjectCompleted</span><span class="o">(</span><span class="n">acknoledgeServiceMock</span><span class="o">,</span> <span class="n">USER_ID</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">verify</span><span class="o">(</span><span class="n">tweetTaskMock</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">call</span><span class="o">();</span>
</span><span class="line">    <span class="n">verify</span><span class="o">(</span><span class="n">acknoledgeServiceMock</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">sendAckFailed</span><span class="o">(</span><span class="n">any</span><span class="o">(</span><span class="n">RuntimeException</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">black@t</span></span>

      




<time class='entry-date' datetime='2015-03-07T09:37:33+01:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:37 am</span></time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blackat.github.io/blog/2015/03/07/how-to-test-1-find-errors-to-make-the-application-works/" data-via="eugeniolentini" data-counturl="http://blackat.github.io/blog/2015/03/07/how-to-test-1-find-errors-to-make-the-application-works/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/02/01/javascript-anatomy-of-an-object/" title="Previous Post: JavaScript: anatomy of an object">&laquo; JavaScript: anatomy of an object</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/03/21/how-to-test-2-tdd-a-simple-example/" title="Next Post: How to test 2: TDD a simple example">How to test 2: TDD a simple example &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/03/21/how-to-test-2-tdd-a-simple-example/">How to Test 2: TDD a Simple Example</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/07/how-to-test-1-find-errors-to-make-the-application-works/">How to Test 1: Find Errors to Make the Application Works</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/01/javascript-anatomy-of-an-object/">JavaScript: Anatomy of an Object</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/11/kii-web-application/">Kii Web Application</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/03/fullstack-javascript-web-application-part-2/">Fullstack Javascript Web Application Part 2</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/blackat">@blackat</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'blackat',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - black@t -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blackatblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blackat.github.io/blog/2015/03/07/how-to-test-1-find-errors-to-make-the-application-works/';
        var disqus_url = 'http://blackat.github.io/blog/2015/03/07/how-to-test-1-find-errors-to-make-the-application-works/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
